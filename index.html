
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>Renpeng's Blog</title>
	<meta name="author" content="Renpeng">

	
	<meta name="description" content="冯威的个人博客">
	<meta name="keywords" content="Android,Java,Nosql">

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="/atom.xml" rel="alternate" title="Renpeng's Blog" type="application/atom+xml">
	
	<link rel="canonical" href="http://renpengben.github.io/">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

         <script src="/javascripts/jquery.min.js"></script>
	
</head>


<body>
	<div class="container">
		<div class="left-col">
			<div class="intrude-less">
			<header id="header" class="inner"><div class="profilepic">	
	<script src="/javascripts/md5.js"></script>
	<script type="text/javascript">
		document.write("<img src='/head.jpg?s=160' alt='Profile Picture' style='width: 160px;' />");
	</script>
</div>
<h1><a href="/">Renpeng's Blog</a></h1>
<p class="subtitle">Android Java NoSql</p>
<nav id="main-nav"><ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/about">About</a></li>
</ul>
</nav>
<nav id="sub-nav">
	<div class="social">
		
		<a class="weibo" href="http://www.weibo.com/renpengben" title="Weibo">Weibo</a>
		
		
		
		
		
		<a class="github" href="https://github.com/renpengben" title="GitHub">GitHub</a>
		
		
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
	</div>
</nav>

</header>				
			</div>
		</div>	
		<div class="mid-col">
			
				
			
			<div class="mid-col-container">
				<div id="content" class="inner">
<div itemscope itemtype="http://schema.org/Blog">


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2014-06-10T20:06:56+08:00" data-updated="true" itemprop="datePublished">Jun 10<span>th</span>, 2014</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/java8/'>java8</a>


</div>
		
 
        <a href="/blog/2014/06/10/lambda-expressions/#comments"></a>
         
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2014/06/10/lambda-expressions/" itemprop="url">Java8新特性之Lambda表达式</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<h2>什么是Lambda表达式？</h2>

<p>   在一般数学计算中lambda表达式就是一个函数，为部分或者所有输入值指定一个输出值，在java中Lambad表达式是以函数的概念引入，可以理解为一种语法更加紧凑的匿名方法，并且允许省略修饰符，返回类型并且某种情况下的参数类型。
</br>
 <strong><em>语法:</em></strong>
 </br>
  lambda基本语法:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'>   <span class="o">(</span><span class="n">parameters</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">expression</span>
</span><span class='line'>   <span class="n">or</span>
</span><span class='line'>   <span class="o">(</span><span class="n">parameters</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span> <span class="n">statements</span><span class="o">;</span> <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<p><strong><em>Examples:</em></strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'>  <span class="o">(</span><span class="kt">int</span> <span class="n">x</span><span class="o">,</span><span class="kt">int</span> <span class="n">y</span><span class="o">)-&gt;</span><span class="n">x</span><span class="o">+</span><span class="n">y</span>   <span class="c1">//取整数x,y并返回它们的和</span>
</span><span class='line'>  <span class="o">(</span><span class="n">x</span><span class="o">,</span> <span class="n">y</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">x</span> <span class="o">-</span> <span class="n">y</span>  <span class="c1">//取整数x,y并返回它们的差                                </span>
</span><span class='line'>  <span class="o">()</span> <span class="o">-&gt;</span> <span class="mi">42</span>  <span class="c1">//不取任何值，直接返回42                                         </span>
</span><span class='line'>  <span class="o">(</span><span class="n">String</span> <span class="n">s</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">s</span><span class="o">)</span> <span class="c1">//取字符串s，在控制台打印，不返回任何值。             </span>
</span><span class='line'>  <span class="n">x</span> <span class="o">-&gt;</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x</span>  <span class="c1">//取一个数字，返回它的2倍                                      </span>
</span><span class='line'>  <span class="n">c</span> <span class="o">-&gt;</span> <span class="o">{</span> <span class="kt">int</span> <span class="n">s</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="na">size</span><span class="o">();</span> <span class="n">c</span><span class="o">.</span><span class="na">clear</span><span class="o">();</span> <span class="k">return</span> <span class="n">s</span><span class="o">;</span> <span class="o">}</span><span class="c1">//取集合c，清空它，然后返回它清空前的大小</span>
</span></code></pre></td></tr></table></div></figure>


<p>
 <strong><em>语法说明</em></strong>
   <pre>
   1.参数类型可以显式声明(ex.1,4)或者隐式推断(ex.2,5,6),显式声明和隐式推断参数不允许用在同一个lambda表达式。
   2.lambda body可以是一个block({}大括号包含代码块ex.6)或者是一个表达式(ex.1-5)。block body可以返回值(ex.6)
   或者什么都不返回()。
   3.如果lambda body是一个表达式，它也可能返回值(ex.1,2,3,5)或者什么都不返回(ex.4)。
   4.隐式推断可以省略()(ex.5,6)。
   5.ex.6 lambda能操作一个集合，同样的，根据上下文给定的参数，如果一个参数a拥有size和clear方法，
   它也能操作并返回其类型的值。
   </pre></p>

<p><strong><em>函数式接口</em></strong></br>
Lambda表达式如何匹配Java的类型系统？每一个lambda都能够通过一个特定的接口，与一个给定的类型进行匹配。</br>
一个所谓的函数式接口必须要有且仅有一个抽象方法声明(java8允许接口有默认方法)。每个与之对应的lambda表达式必须要与抽象方法的声明相匹配。</br></br>
1、一个可以接受Lambda表达式的接口只能有一个抽象方法，否则在编译时将抛出异常。</br>
2、为了显示的说明某接口是可使用lambda表达式,可以使用<code>   @FunctionalInterface </code>注解该接口。</br></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="nd">@FunctionalInterface</span>
</span><span class='line'><span class="kd">interface</span> <span class="nc">Converter</span><span class="o">&lt;</span><span class="n">F</span><span class="o">,</span> <span class="n">T</span><span class="o">&gt;</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">T</span> <span class="nf">convert</span><span class="o">(</span><span class="n">F</span> <span class="n">from</span><span class="o">);</span><span class="c1">//抽象方法只能一个</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">default</span> <span class="kt">double</span> <span class="nf">sqrt</span><span class="o">(</span><span class="kt">int</span> <span class="n">a</span><span class="o">)</span> <span class="o">{</span><span class="c1">//可以多个接口默认方法</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">Math</span><span class="o">.</span><span class="na">sqrt</span><span class="o">(</span><span class="n">a</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">Converter</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Integer</span><span class="o">&gt;</span> <span class="n">converter</span> <span class="o">=</span> <span class="o">(</span><span class="n">from</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">Integer</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">from</span><span class="o">);</span>
</span><span class='line'><span class="n">Integer</span> <span class="n">converted</span> <span class="o">=</span> <span class="n">converter</span><span class="o">.</span><span class="na">convert</span><span class="o">(</span><span class="s">&quot;123&quot;</span><span class="o">);</span>
</span><span class='line'><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">converted</span><span class="o">);</span>    <span class="c1">// 123</span>
</span></code></pre></td></tr></table></div></figure>


<p>
<a href="">Default Methods(默认方法)详情</a>
</br>
注意，如果不写<code>   @FunctionalInterface </code>标注，程序也是正确的。</p>

<p><strong><em>官网例子</em></strong>
</br></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'>   <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Calculator</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">interface</span> <span class="nc">IntegerMath</span> <span class="o">{</span>
</span><span class='line'>        <span class="kt">int</span> <span class="nf">operation</span><span class="o">(</span><span class="kt">int</span> <span class="n">a</span><span class="o">,</span> <span class="kt">int</span> <span class="n">b</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">operateBinary</span><span class="o">(</span><span class="kt">int</span> <span class="n">a</span><span class="o">,</span> <span class="kt">int</span> <span class="n">b</span><span class="o">,</span> <span class="n">IntegerMath</span> <span class="n">op</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">op</span><span class="o">.</span><span class="na">operation</span><span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">...</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">Calculator</span> <span class="n">myApp</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Calculator</span><span class="o">();</span>
</span><span class='line'>        <span class="n">IntegerMath</span> <span class="n">addition</span> <span class="o">=</span> <span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="o">;</span><span class="c1">//隐式推断类型</span>
</span><span class='line'>        <span class="n">IntegerMath</span> <span class="n">subtraction</span> <span class="o">=</span> <span class="o">(</span><span class="kt">int</span> <span class="n">a</span><span class="o">,</span> <span class="kt">int</span> <span class="n">b</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">a</span> <span class="o">-</span> <span class="n">b</span><span class="o">;</span><span class="c1">//显式声明类型</span>
</span><span class='line'>        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;40 + 2 = &quot;</span> <span class="o">+</span>
</span><span class='line'>            <span class="n">myApp</span><span class="o">.</span><span class="na">operateBinary</span><span class="o">(</span><span class="mi">40</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="n">addition</span><span class="o">));</span>
</span><span class='line'>        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;20 - 10 = &quot;</span> <span class="o">+</span>
</span><span class='line'>            <span class="n">myApp</span><span class="o">.</span><span class="na">operateBinary</span><span class="o">(</span><span class="mi">20</span><span class="o">,</span> <span class="mi">10</span><span class="o">,</span> <span class="n">subtraction</span><span class="o">));</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>为什么Java要增加lambda表达式？</h2>

<p>Lambda表达式，也叫做闭包，是一个在很多现代程序语言中十分流行的特性。在众多不同的原因中当中，Java平台最迫切的原因之一是lambda表达式能简化多线程环境下集合的分布式处理。
</br>
<strong><em>1.内部循环和外部循环</em></strong>
</br></p>

<p>  常规的外部循环:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">numbers</span> <span class="o">=</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="mi">6</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'><span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">number</span> <span class="o">:</span> <span class="n">numbers</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">number</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>
这种情况简单的存在3个缺点:</p>

<p>1.只能顺序处理List中的元素</p>

<p>2.不能充分利用多核CPU</p>

<p>3.不利于编译器优化
</br>
使用Lamdba表达式内部循环：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">numbers</span> <span class="o">=</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="mi">6</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'><span class="n">numbers</span><span class="o">.</span><span class="na">forEach</span><span class="o">((</span><span class="n">Integer</span> <span class="n">value</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">value</span><span class="o">));</span>
</span></code></pre></td></tr></table></div></figure>


<p>
1.不一定需要顺序处理List中的元素，顺序可以不确定</p>

<p>2.可以并行处理，充分利用多核CPU的优势</p>

<p>3.有利于JIT编译器对代码进行优化
</br></p>

<p><strong><em>2、传递行为，而不仅仅是传值</em></strong>
传值局限性的场景</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">numbers</span> <span class="o">=</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="mi">6</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kt">int</span> <span class="nf">sumAll</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">numbers</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
</span><span class='line'>    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">number</span> <span class="o">:</span> <span class="n">numbers</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">total</span> <span class="o">+=</span> <span class="n">number</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">total</span><span class="o">;</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>
sumAll算法很简单，完成的是将List中所有元素相加。某一天如果需要增加一个对List中所有偶数求和的方法sumAllEven，如下：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kt">int</span> <span class="nf">sumAllEven</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">numbers</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
</span><span class='line'>    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">number</span> <span class="o">:</span> <span class="n">numbers</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="o">(</span><span class="n">number</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">total</span> <span class="o">+=</span> <span class="n">number</span><span class="o">;</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">total</span><span class="o">;</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>
又有一天，需要增加第三个方法：对List中所有大于3的元素求和，那是不是继续加下面的方法呢?</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kt">int</span> <span class="nf">sumAllEven</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">numbers</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
</span><span class='line'>    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">number</span> <span class="o">:</span> <span class="n">numbers</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="o">(</span><span class="n">number</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">total</span> <span class="o">+=</span> <span class="n">number</span><span class="o">;</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">total</span><span class="o">;</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>
比较这三个方法，发现了一个很明显的“代码臭味”—— 代码重复。
如果使用Lambda表达式，那么需要Lambda表达式中的谓词（Predicate）发挥作用：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kt">int</span> <span class="nf">sumAll</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">numbers</span><span class="o">,</span> <span class="n">Predicate</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">p</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
</span><span class='line'>    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">number</span> <span class="o">:</span> <span class="n">numbers</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">test</span><span class="o">(</span><span class="n">number</span><span class="o">))</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">total</span> <span class="o">+=</span> <span class="n">number</span><span class="o">;</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">total</span><span class="o">;</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">sumAll</span><span class="o">(</span><span class="n">numbers</span><span class="o">,</span> <span class="n">n</span> <span class="o">-&gt;</span> <span class="kc">true</span><span class="o">);</span>
</span><span class='line'><span class="n">sumAll</span><span class="o">(</span><span class="n">numbers</span><span class="o">,</span> <span class="n">n</span> <span class="o">-&gt;</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="o">);</span>
</span><span class='line'><span class="n">sumAll</span><span class="o">(</span><span class="n">numbers</span><span class="o">,</span> <span class="n">n</span> <span class="o">-&gt;</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="o">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>
</br>
Preducate源码如下：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="nd">@FunctionalInterface</span>
</span><span class='line'><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Predicate</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="cm">/**</span>
</span><span class='line'><span class="cm">     * Evaluates this predicate on the given argument.</span>
</span><span class='line'><span class="cm">     *</span>
</span><span class='line'><span class="cm">     * @param t the input argument</span>
</span><span class='line'><span class="cm">     * @return {@code true} if the input argument matches the predicate,</span>
</span><span class='line'><span class="cm">     * otherwise {@code false}</span>
</span><span class='line'><span class="cm">     */</span>
</span><span class='line'>    <span class="kt">boolean</span> <span class="nf">test</span><span class="o">(</span><span class="n">T</span> <span class="n">t</span><span class="o">);</span>
</span><span class='line'><span class="o">.....</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>
<strong><em>3、Consumer与Loan Pattern</em></strong>
</br>
比如有一个资源类Resource：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Resource</span> <span class="o">{</span>
</span><span class='line'>  <span class="kd">public</span> <span class="nf">Resource</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Opening resource&quot;</span><span class="o">);</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">operate</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Operating on resource&quot;</span><span class="o">);</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">dispose</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Disposing resource&quot;</span><span class="o">);</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'><span class="c1">//调用</span>
</span><span class='line'><span class="n">Resource</span> <span class="n">resource</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Resource</span><span class="o">();</span>
</span><span class='line'><span class="k">try</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">resource</span><span class="o">.</span><span class="na">operate</span><span class="o">();</span>
</span><span class='line'><span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">resource</span><span class="o">.</span><span class="na">dispose</span><span class="o">();</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>
但是有一个问题，如果很多地方都要用到这个资源，那么就存在很多段类似这样的代码，这很明显违反了DRY（Don&rsquo;t Repeat It Yourself）原则。而且如果某位程序员由于某些原因忘了用try/finally处理资源，那么很可能导致内存泄漏。那咋办呢？Java 8提供了一个Consumer接口，代码改写为如下：</br>
因为对资源对象resource执行operate方法时可能抛出RuntimeException，所以需要在finally语句块中释放资源，防止可能的内存泄漏。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Resource</span> <span class="o">{</span>
</span><span class='line'>  <span class="kd">public</span> <span class="nf">Resource</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Opening resource&quot;</span><span class="o">);</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">operate</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Operating on resource&quot;</span><span class="o">);</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">dispose</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Disposing resource&quot;</span><span class="o">);</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">withResource</span><span class="o">(</span><span class="n">Consumer</span><span class="o">&lt;</span><span class="n">Resource</span><span class="o">&gt;</span> <span class="n">consumer</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">Resource</span> <span class="n">resource</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Resource</span><span class="o">();</span>
</span><span class='line'>      <span class="k">try</span> <span class="o">{</span>
</span><span class='line'>          <span class="n">consumer</span><span class="o">.</span><span class="na">accept</span><span class="o">(</span><span class="n">resource</span><span class="o">);</span>
</span><span class='line'>      <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
</span><span class='line'>          <span class="n">resource</span><span class="o">.</span><span class="na">dispose</span><span class="o">();</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">Resource</span><span class="o">.</span><span class="na">withResource</span><span class="o">(</span><span class="n">resource</span> <span class="o">-&gt;</span> <span class="n">resource</span><span class="o">.</span><span class="na">operate</span><span class="o">());</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="nl">Console:</span>
</span><span class='line'><span class="n">Opening</span> <span class="n">resource</span>
</span><span class='line'><span class="n">Operating</span> <span class="n">on</span> <span class="n">resource</span>
</span><span class='line'><span class="n">Disposing</span> <span class="n">resource</span>
</span></code></pre></td></tr></table></div></figure>


<p>
外部要访问Resource，只能通过withResource方法了，而且也完全杜绝了因人为疏忽而导致的潜在内存泄漏。
</br></p>

<h2>Lambda表达式范围</h2>

<p>对于lambdab表达式外部的变量，其访问权限的粒度与匿名对象的方式非常类似。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="nd">@FunctionalInterface</span>
</span><span class='line'><span class="kd">interface</span> <span class="nc">Converter</span><span class="o">&lt;</span><span class="n">F</span><span class="o">,</span> <span class="n">T</span><span class="o">&gt;</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">T</span> <span class="nf">convert</span><span class="o">(</span><span class="n">F</span> <span class="n">from</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span></code></pre></td></tr></table></div></figure>


<p>
1.访问局部变量</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">final</span> <span class="kt">int</span> <span class="n">num</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>
</span><span class='line'><span class="n">Converter</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">stringConverter</span> <span class="o">=</span>
</span><span class='line'>        <span class="o">(</span><span class="n">from</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">String</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">from</span> <span class="o">+</span> <span class="n">num</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'><span class="n">stringConverter</span><span class="o">.</span><span class="na">convert</span><span class="o">(</span><span class="mi">2</span><span class="o">);</span>     <span class="c1">// 3</span>
</span></code></pre></td></tr></table></div></figure>


<p>
与匿名对象不同的是，变量num不一定是final。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'> <span class="kt">int</span> <span class="n">num</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span><span class="c1">//去掉final也是正确的</span>
</span><span class='line'><span class="n">Converter</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">stringConverter</span> <span class="o">=</span>
</span><span class='line'>        <span class="o">(</span><span class="n">from</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">String</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">from</span> <span class="o">+</span> <span class="n">num</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'><span class="n">stringConverter</span><span class="o">.</span><span class="na">convert</span><span class="o">(</span><span class="mi">2</span><span class="o">);</span>     <span class="c1">// 3</span>
</span></code></pre></td></tr></table></div></figure>


<p>
但是num在编译的时候隐式的当作final变量来处理。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kt">int</span> <span class="n">num</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>
</span><span class='line'><span class="n">Converter</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">stringConverter</span> <span class="o">=</span>
</span><span class='line'>        <span class="o">(</span><span class="n">from</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">String</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">from</span> <span class="o">+</span> <span class="n">num</span><span class="o">);</span>
</span><span class='line'><span class="n">num</span> <span class="o">=</span> <span class="mi">3</span><span class="o">;</span><span class="c1">//这样是错误的不能对final变量重新复制，在lambda表达式内部改变num的值也是不允许的</span>
</span></code></pre></td></tr></table></div></figure>


<p>
2.访问成员变量和静态变量
与局部变量不同，我们在lambda表达式的内部能获取到对成员变量或静态变量的读写权。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">class</span> <span class="nc">LambdaTest</span> <span class="o">{</span>
</span><span class='line'>    <span class="kd">static</span> <span class="kt">int</span> <span class="n">outerStaticNum</span><span class="o">;</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">outerNum</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="kt">void</span> <span class="nf">testScopes</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">Converter</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">stringConverter1</span> <span class="o">=</span> <span class="o">(</span><span class="n">from</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">outerNum</span> <span class="o">=</span> <span class="mi">23</span><span class="o">;</span>
</span><span class='line'>            <span class="k">return</span> <span class="n">String</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">from</span><span class="o">);</span>
</span><span class='line'>        <span class="o">};</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">Converter</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">stringConverter2</span> <span class="o">=</span> <span class="o">(</span><span class="n">from</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">outerStaticNum</span> <span class="o">=</span> <span class="mi">72</span><span class="o">;</span>
</span><span class='line'>            <span class="k">return</span> <span class="n">String</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">from</span><span class="o">);</span>
</span><span class='line'>        <span class="o">};</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>
默认方法无法在lambda表达式内部被访问。因此下面的代码是无法通过编译的：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">interface</span> <span class="nc">Formula</span> <span class="o">{</span>
</span><span class='line'>    <span class="kt">double</span> <span class="nf">calculate</span><span class="o">(</span><span class="kt">int</span> <span class="n">a</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">default</span> <span class="kt">double</span> <span class="nf">sqrt</span><span class="o">(</span><span class="kt">int</span> <span class="n">a</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">Math</span><span class="o">.</span><span class="na">sqrt</span><span class="o">(</span><span class="n">a</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'><span class="n">Formula</span> <span class="n">formula</span> <span class="o">=</span> <span class="o">(</span><span class="n">a</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">sqrt</span><span class="o">(</span> <span class="n">a</span> <span class="o">*</span> <span class="mi">100</span><span class="o">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>
<strong><em>参考资料:</em></strong>
</br>
<a href="http://www.lambdafaq.org/">http://www.lambdafaq.org/</a>
</br>
<a href="http://docs.oracle.com/javase/tutorial/java/javaOO/lambdaexpressions.html#use-case">http://docs.oracle.com/javase/tutorial/java/javaOO/lambdaexpressions.html#use-case</a>
</br>
<a href="http://java.dzone.com/articles/why-we-need-lambda-expressions">http://java.dzone.com/articles/why-we-need-lambda-expressions</a>
</br>
<a href="http://java.dzone.com/articles/why-we-need-lambda-expressions-0">http://java.dzone.com/articles/why-we-need-lambda-expressions-0</a>
</br>
<a href="http://www.ituring.com.cn/article/22143">http://www.ituring.com.cn/article/22143</a></p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2014-06-10T20:00:34+08:00" data-updated="true" itemprop="datePublished">Jun 10<span>th</span>, 2014</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/java8/'>java8</a>


</div>
		
 
        <a href="/blog/2014/06/10/ecnew-java8/#comments"></a>
         
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2014/06/10/ecnew-java8/" itemprop="url">Java 8新特性简介</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p> <h4>Java Programming Language(Java语言)</h4>
   1.<a href="/blog/2014/06/10/lambda-expressions/">Lambda Expressions(Lambad表达式)</a>
   </br>
   2.Method References(方法引用)
   </br>
   3.Default Methods(默认方法)
   </br>
   4.Repeating Annotations(重复注解)
   </br>
   5.Type Annotations(类型注解)
   </br>
   6.Improved type inference(改进类型推断)
   </br>
   7.Method parameter reflection(方法参数反射)
 <h4>Collections(集合)</h4>
   1.New java.util.stream package(新包java.util.stream)
   </br>
   2.Performance Improvement for HashMaps with Key Collisions(HashMaps Key碰撞的性能改进)
   </br>
   <strong><em>未完待续&hellip;</em></strong>
   </br>
   <strong><em>参考资料:</em></strong>
</br>
 <a href="http://www.oracle.com/technetwork/java/javase/8-whats-new-2157071.html">http://www.oracle.com/technetwork/java/javase/8-whats-new-2157071.html</a></p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2014-06-10T19:51:11+08:00" data-updated="true" itemprop="datePublished">Jun 10<span>th</span>, 2014</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/java8/'>java8</a>


</div>
		
 
        <a href="/blog/2014/06/10/eclipse-kepler-java8/#comments"></a>
         
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2014/06/10/eclipse-kepler-java8/" itemprop="url">Eclipse Kepler搭建Java8开发环境</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>俗话说&#8221;工欲善其事，必先利其器&#8221;,Eclipse Kepler已支持Java 8,可以下载官方提供的<a href="http://eclipse.org/downloads/index-java8.php">Java™ 8 Support版本</a>版本来使用此功能。已经下载的Eclipse Kepler SR2也可以通过安装插件的方式来支持 Java 8，具体步骤如下：</p>

<p><strong><em>下载<a href="http://www.oracle.com/technetwork/java/javase/downloads/index-jsp-138363.html">Java 8</a>并确保你的Eclipse版本是Kepler SR2。</br></em></strong></p>

<p> 选择菜单：”Help > Eclipse Marketplace…”。</br>
 在搜索框中输入”Java 8 Kepler”。
 安装<a href="http://marketplace.eclipse.org/content/java-8-support-eclipse-kepler-sr2">Java&nbsp;8 support for
 Eclipse&nbsp;Kepler&nbsp;SR2</a>插件。</br>
 安装其他可选插件：</br>
 Java EE扩展支持：<a href="http://marketplace.eclipse.org/content/java-8-facet-web-tools-eclipse-kepler-sr2">Java 8 Facet for Web Tools for Eclipse Kepler SR2</a></br>
 Maven扩展支持：<a href="http://marketplace.eclipse.org/content/java%E2%84%A2-8-support-m2e-eclipse-kepler">Java 8 support for m2e for Eclipse Kepler SR2</a></p>

<p><img src="/images/post-image/java8-marketplace.png">
</br>
<strong><em>多版本JDK共存问题</em></strong>
</br>
平常开发环境使用JDK7，如果又要使用JDK8做一些学习测试，那么可以在eclipse.ini文件中指定-vm参数，JAVA_HOME还是使用JDK7相互之间不影响。
</br></p>

<pre>
-vm
C:/Program Files (x86)/Java/jdk1.8.0_05/bin/javaw.exe
</pre>


<p><strong><em>参考资料:</em></strong>
</br>
<a href="http://www.eclipse.org/downloads/java8/">http://www.eclipse.org/downloads/java8/</a></p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2014-05-24T22:21:33+08:00" data-updated="true" itemprop="datePublished">May 24<span>th</span>, 2014</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/javabing-fa/'>java并发</a>, <a class='category' href='/blog/categories/du-shu-bi-ji/'>读书笔记</a>


</div>
		
 
        <a href="/blog/2014/05/24/basic-thread-synchronization/#comments"></a>
         
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2014/05/24/basic-thread-synchronization/" itemprop="url">《Java 7 Concurrency Cookbook 读书笔记》基本线程同步</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<pre><code>临界区是访问一个共享资源在同一时间不能被超过一个线程执行的代码块。
</code></pre>

<p><strong>同步方法</strong></p>

<pre><code>每个方法声明为synchronized是一个临界区。
synchronized关键字来保护访问的代码块，替换在整个方法上使用synchronized关键字。
一般使用this关键字引用执行该方法的对象。

synchronized (this) {
// Java code
}
</code></pre>

<p><strong>在同步的类里安排独立属性</strong></p>

<pre><code>当使用synchronized关键字来保护代码块时，必须通过一个对象的引用作为参数。
通常，使用this关键字来引用执行该方法的对象，当有多个共享属性时可以创建多个独立属性，
保证每个共享变量同步访问。
</code></pre>

<p><strong>在同步代码中使用条件</strong></p>

<pre><code>Java在Object对象中提供wait()，notify()，和notifyAll() 方法的实现。一个线程可以在
synchronized代码块中调用wait()方法。如果在synchronized代码块外部调用wait()方法，
JVM会抛出IllegalMonitorStateException异常。
当线程调用wait()方法，JVM让这个线程睡眠，并且释放控制synchronized代码块的对象，
这样，虽然它正在执行但允许其他线程执行由该对象保护的其他synchronized代码块。
为了唤醒线程，你必须在由相同对象保护的synchronized代码块中调用notify()或notifyAll()方法。
</code></pre>

<p><strong>使用Lock同步代码块</strong></p>

<pre><code>Lock 接口比synchronized关键字提供更多额外的功能。新功能之一是实现的tryLock()方法。
这种方法试图获取锁的控制权并且如果它不能获取该锁，是因为其他线程在使用这个锁，
它将返回这个锁。使用synchronized关键字，当线程A试图执行synchronized代码块，
如果线程B正在执行它，那么线程A将阻塞直到线程B执行完synchronized代码块。
使用锁，你可以执行tryLock()方法，这个方法返回一个 Boolean值表示，
是否有其他线程正在运行这个锁所保护的代码。  

Lock接口允许读写操作分离。
Lock接口比synchronized关键字提供更好的性能。

private final Lock lock=new ReentrantLock();
//获取锁
lock.lock();
try {

   } catch (InterruptedException e) {
 }finally { 
//释放锁
lock.unlock();
 }

Lock 接口（和ReentrantLock类）包含其他方法来获取锁的控制权，那就是tryLock()方法。
这个方法与lock()方法的最大区别是，如果一 个线程调用这个方法不能获取Lock接口的控制权
时，将会立即返回并且不会使这个线程进入睡眠。这个方法返回一个boolean值，
true表示这个线程 获取了锁的控制权，false则表示没有。

ReentrantLock锁可重入。
</code></pre>

<p><strong>使用读/写锁同步数据访问</strong></p>

<pre><code>ReadWriteLock接口和唯一一个实现它的ReentrantReadWriteLock类。
这个类提供两把锁，一把用于读操作和一把用于写操作。同时可以有多个线程执行读操作，
但只有一个线程可以执行写操作。当一个线程正在执行一个写操作，不可能有任何线程执行读操作。

private ReadWriteLock lock=new ReentrantReadWriteLock();

//读操作锁
private void read(){

lock.readLock().lock();
//read code
lock.readLock().unlock();

}
//写操作锁
private void write(){
lock.writeLock().lock();
//write code
lock.writeLock().unlock();
}
</code></pre>

<p><strong>修改Lock的公平性</strong></p>

<pre><code>在ReentrantLock类和 ReentrantReadWriteLock类的构造器中，允许一个名为fair的boolean
类型参数， 默认值为 false。
当多个线程等待一把锁时，这个锁必须选择一个进入临界区，当fair为false时这个选择没有标准
即非公平模式。
当这个值为true时，锁将选择等待时间最长的进入临界区即公平模式。由于tryLock()方法并不会
使线程进入睡眠，因此此参数不影响它。
</code></pre>

<p><strong>在Lock中使用多条件</strong></p>

<pre><code>Condition条件变量，等待某种条件的发生，条件发生后，可以唤醒等待在该条件上的一个线程，
或所有线程。条件变量要与锁一起协同工作。

 ReentrantLock lock = new ReentrantLock(); 
 Condition condition = lock.newCondition(); 

 condition.await();//满足某条件时等待  Object.wait();
 condition.signal(); //唤醒等待的其中一个线程  Object.notify(); 
 condition.signalAll(); //唤醒等待的所有线程   Object.notifyAll();
</code></pre>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2014-05-10T23:16:49+08:00" data-updated="true" itemprop="datePublished">May 10<span>th</span>, 2014</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/javabing-fa/'>java并发</a>, <a class='category' href='/blog/categories/du-shu-bi-ji/'>读书笔记</a>


</div>
		
 
        <a href="/blog/2014/05/10/thread-management/#comments"></a>
         
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2014/05/10/thread-management/" itemprop="url">《Java 7 Concurrency Cookbook 读书笔记》线程管理</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p><strong>java中创建线程有2种方式：</strong></p>

<pre><code>  1.继承Thread类，覆盖run方法。
  2.构建实现Runnable接口类，然后创建一个Thread类对象传入一个Runnable对象作为构造参数。
</code></pre>

<p><strong>获取和设置线程信息：</strong></p>

<pre><code> ID: 每个线程的独特标识。
 Name: 线程的名称。
 Priority: 线程对象的优先级。优先级别在1-10之间，1是最低级，10是最高级。
 Status: 线程的状态。
 Tips:
 setPriority() 方法会抛出 IllegalArgumentException 异常，如果设置的优先级不是在1-10之间。
 在Java中，线程只能有这6种中的一种状态：  new, runnable, blocked, waiting,
 time waiting, 或 terminated。
</code></pre>

<p><strong>线程的中断：</strong></p>

<pre><code>   Thread类有一个boolean类型的属性表明线程是否被中断，当调用线程的interrupt()方法,
   此属性被设置为true,isInterrupted() 方法仅返回属性值。

   isInterrupted()和interrupted()区别:
   isInterrupted()不会改变interrupted属性值，interrupted()会设置为false，
   interrupted() 方法是一个静态方法，建议使用isInterrupted()方法。
</code></pre>

<p><strong>操作线程的中断机制</strong></p>

<pre><code>   在Thread类的run方法中捕获InterruptedException异常来控制线程的中断。

    private void do() throws InterruptedException
    { 
     //....
     if (Thread.interrupted()) {
    throw new InterruptedException();
     }
     }
      @Override
      public void run() {
       try {
      do();
      } catch (InterruptedException e) {

    } 
    }
</code></pre>

<p><strong>线程的睡眠与恢复</strong></p>

<pre><code>  Thread类的 sleep(long millis) 方法 。表示线程休眠millis毫秒。
  TimeUnit枚举元素的sleep(long millis)方法同样能使当前线程睡眠millis毫秒。
  2种线程休眠的方法都会抛出InterruptedException异常。
</code></pre>

<p><strong>等待线程的终结</strong></p>

<pre><code>  当前线程调用某个线程的join()方法，当前线程会暂停直到被调用线程执行完成。
  join (long milliseconds)
  join (long milliseconds, long nanos)

  ex：thread1调用thread2.join(1000)，那么thread1暂停运行，
  直到一下其中一个条件发生，join方法返回：
  thread2结束运行
  1000毫秒过去了
</code></pre>

<p><strong>守护线程的创建和运行</strong></p>

<pre><code>  在Java中有两类线程：用户线程 (User Thread)、守护线程 (Daemon Thread)。

  守护线程，是指在程序运行的时候在后台提供一种通用服务的线程，
  比如垃圾回收线程就是一个很称职的守护者，并且这种线程并不属于程序中不可或缺的部分。
  因此，当所有的非守护线程结束时，程序也就终止了，同时会杀死进程中的所有守护线程。
  反过来说，只要任何非守护线程还在运行，程序就不会终止。

  Thread类的 setDaemon() 方法设置线程为守护线程，此方法必须在调用start()方法之前调用。
  isDaemon() 方法来检查线程是否是守护线程（方法返回 true) 或者是用户线程 (方法返回 false)。
</code></pre>

<p><strong>处理线程非检测异常</strong></p>

<pre><code>  Java中有2种异常：
  检测异常(Checked Exceptions)：这种异常必须强制捕获或者继续抛出异常（throws）。
  非检测异常(Unchecked Exceptions)：这种异常无需强制捕获。
  在线程对象run()方法中抛出一个检测异常必须捕获，因为run()方法不接受throws抛出异常。

  在Java处理Thread中的非检测异常类，需要实现UncaughtExceptionHandler接口。
  public class ExceptionHandler implements UncaughtExceptionHandler {

  @Override
  public void uncaughtException(Thread t, Throwable e) {

 }
 }
 在线程启动之前设置setUncaughtExceptionHandler(new ExceptionHandler());

当在一个线程里抛出一个异常，但是这个异常没有被捕获（非检查异常）， 
JVM 检查线程的相关方法是否有设置一个未捕捉异常的处理者 。
如果有JVM使用Thread对象和Exception作为参数调用此方法 。
如果线程没有捕捉未捕获异常的处理者， 那么JVM会把异常的 stack trace 写入操控台并结束任务。
静态方法 setDefaultUncaughtExceptionHandler() 为应用里的所有线程对象建立异常handler 。
JVM检测异常3种潜在的Handler：Thread UncaughtExceptionHandler-&gt;
Thread Group UncaughtExceptionHandler-&gt;Default Thread 
UncaughtExceptionHandler-&gt;print stack trace
</code></pre>

<p><strong>本地线程变量</strong></p>

<pre><code>ThreadLocal类为线程的变量存储独立的属性值。
ThreadLocal&lt;Object&gt; threadLocal = new ThreadLocal&lt;Object&gt;() {
    //初始值
    protected Object initialValue() {
        return new Object();
    };

    public void set(Object value) {
    };

    public Object get() {
        return new Object();
    };
    //移除此线程局部变量的值。
    public void remove() {
    };

}; 
InheritableThreadLocal 类提供线程创建线程的值的遗传性 。
如果线程A有一个本地线程变量，然后它创建了另一个线程B，
那么线程B将有与A相同的本地线程变量值。
你可以覆盖 childValue() 方法来初始子线程的本地线程变量的值。
它接收父线程的本地线程变量作为参数。
InheritableThreadLocal&lt;Object&gt; inheritableThreadLocal = 
new InheritableThreadLocal&lt;Object&gt;() {
    protected Object childValue(Object parentValue) {
        return parentValue;
    };
};
</code></pre>

<p><strong>线程组</strong></p>

<pre><code>Java提供ThreadGroup类来组织线程。 
ThreadGroup对象可以由Thread对象组成和由另外的ThreadGroup对象组成,生成线程树结构。
ThreadGroup threadGroup = new ThreadGroup(group name);
Thread thread=new Thread(threadGroup, runnableimpl);
activeCount() 和 enumerate() 方法来获取线程个数和与ThreadGroup对象关联的线程的列表。
</code></pre>

<p><strong>处理线程组内非检测异常</strong></p>

<pre><code>public class MyThreadGroup extends ThreadGroup {
public MyThreadGroup(String name) {
super(name);
}
@Override
public void uncaughtException(Thread t, Throwable e) {
//覆盖此方法
}
}
</code></pre>

<p><strong>线程工厂</strong></p>

<pre><code>ThreadFactory线程工厂。
ThreadFactory 接口只有一个方法是newThread。它接收 Runnable 对象作为参数并返回一个 Thread对象。
public class MyThreadFactory implements ThreadFactory {
@Override
public Thread newThread(Runnable r) {
    return new Thread(r);
}
}
</code></pre>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2014-03-23T15:38:15+08:00" data-updated="true" itemprop="datePublished">Mar 23<span>rd</span>, 2014</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/android/'>android</a>


</div>
		
 
        <a href="/blog/2014/03/23/fragmenttabhost-fragment/#comments"></a>
         
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2014/03/23/fragmenttabhost-fragment/" itemprop="url">FragmentTabHost切换Fragment时避免重复加载UI</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p><span>使用FragmentTabHost时，Fragment之间切换时每次都会调用onCreateView方法，导致每次Fragment的布局都重绘，无法保持Fragment原有状态。</span></p>

<p><span>解决办法：在Fragment onCreateView方法中缓存View。<span></p>

<pre><code>    //缓存Fragment view
    private View rootView;

    @Override
    public View onCreateView(LayoutInflater inflater, ViewGroup container, 
    Bundle     savedInstanceState) {
    if(rootView==null){
        rootView=inflater.inflate(R.layout.tab_fragment, null);
    }
    //缓存的rootView需要判断是否已经被加过parent， 如果有parent需要从parent删除，
    //要不然会发生这个rootview已经有parent的错误。    
    ViewGroup parent = (ViewGroup) rootView.getParent();
    if (parent != null) {
        parent.removeView(rootView);
    } 
    return rootView;
    }
</code></pre>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2014-03-22T16:18:36+08:00" data-updated="true" itemprop="datePublished">Mar 22<span>nd</span>, 2014</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/octopress/'>Octopress</a>


</div>
		
 
        <a href="/blog/2014/03/22/octopress-write-blog/#comments"></a>
         
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2014/03/22/octopress-write-blog/" itemprop="url">Octopress写博客</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p> <h4> 1.安装ruby</h4>
 <h4> 2.安装Octopress</h4>
 上面2步网上很多资料<a href="http://blog.segmentfault.com/yaashion_xiang/1190000000364677">传送门</a>
 <h4> 3.部署到github</h4></p>

<pre><code>  rake setup_github_pages
</code></pre>

<p>   按照提示输入github用户名密码，输入以下命令部署博客,push到github的master分支</p>

<pre><code>  rake generate
  rake deploy
</code></pre>


		
		<a href="/blog/2014/03/22/octopress-write-blog/" class="more-link">阅读全文 &rarr;</a>
	</div>

</article>

</div>
<nav id="pagenavi">
    
    
   <center><a href="/blog/archives">All Archives</a></center>
</nav>
</div>
			</div>
			<footer id="footer" class="inner"><p>
  Copyright &copy; 2014 - Renpeng -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

Design credit: <a href="http://shashankmehta.in/archive/2012/greyshade.html">Shashank Mehta</a></footer>
			<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->







		</div>
	</div>
</body>
</html>
